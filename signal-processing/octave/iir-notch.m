d = [  -0.18669,
-0.03823,
0.08256,
-0.0824,
-0.19467,
0.03946,
0.25656,
0.06872,
-0.14944,
-0.07867,
0.03147,
-0.09943,
-0.14465,
0.07298,
0.20228,
0.0485,
-0.09783,
0.01711,
0.08256,
-0.06377,
-0.07654,
0.11555,
0.11927,
-0.1255,
-0.19787,
0.05436,
0.20281,
0.05382,
-0.00364,
0.0634,
-0.04462,
-0.24044,
-0.15849,
0.11448,
0.11236,
-0.14465,
-0.05579,
0.26826,
0.26081,
-0.05526,
-0.1388,
0.05755,
0.02988,
-0.15743,
-0.14838,
0.00221,
-0.02174,
-0.12922,
0.06447,
0.28848,
0.06979,
-0.28247,
-0.17552,
0.1645,
0.17781,
-0.07442,
-0.13188,
0.03946,
0.11927,
0.13045,
0.10544,
0.0054,
-0.1388,
-0.1239,
0.07245,
0.06447,
-0.13827,
-0.1388,
0.0916,
0.1645,
-0.051,
-0.11326,
0.07032,
0.08415,
-0.05473,
-0.04781,
0.07564,
0.00434,
-0.18031,
-0.09943,
0.15759,
0.16663,
-0.10687,
-0.14519,
0.0767,
0.16557,
0.01019,
-0.01429,
0.0352,
-0.05686,
-0.07974,
0.11981,
0.23368,
-0.00471,
-0.23937,
-0.12976,
0.03839,
0.02456,
-0.01695,
0.11448,
0.14481,
-0.04834,
-0.1106,
0.09267,
0.15918,
-0.06377,
-0.13082,
0.01924,
0.05169,
-0.08772,
-0.11273,
0.05329,
0.0203,
-0.10528,
-0.00152,
0.15971,
0.06074,
-0.17552,
-0.13614,
0.05595,
-0.03344,
-0.15849,
0.01391,
0.19111,
0.07298,
-0.2133,
-0.15796,
0.11182,
0.13364,
-0.00258,
0.01285,
0.08628,
0.03254,
-0.10209,
-0.01908,
0.07564,
-0.04994,
-0.10741,
0.04158,
0.1065,
-0.0377,
-0.08453,
0.15067,
0.19749,
-0.07974,
-0.20266,
0.00221,
0.06766,
-0.06803,
0.00434,
0.19111,
0.07138,
-0.22926,
-0.19467,
0.1097,
0.14215,
-0.0824,
-0.0542,
0.23421,
0.19909,
-0.10315,
-0.12869,
0.09373,
-0.0212,
-0.31067,
-0.09996,
0.30072,
0.19643,
-0.12231,
-0.02227,
0.21612,
0.01391,
-0.31866,
-0.15157,
0.24698,
0.15705,
-0.15849,
-0.03025,
0.25975,
0.13896,
-0.2133,
-0.24256,
-0.06484,
-0.12124,
-0.1521,
0.15226,
0.3119,
0.02083,
-0.18084,
0.05542,
0.16929,
-0.13295,
-0.30322,
0.00434,
0.22995,
-0.03291,
-0.21117,
0.08628,
0.21931,
-0.09091,
-0.16328,
0.17834,
0.20335,
-0.20691,
-0.2681,
0.181,
0.30019,
-0.12337,
-0.29205,
0.02935,
0.14375,
-0.12497,
-0.11965,
0.18898,
0.06659,
-0.28088,
-0.06537,
0.37894,
0.18153,
-0.36069,
-0.20798,
0.36298,
0.3236,
-0.23671,
-0.28513,
0.12513,
0.15333,
-0.16221,
-0.09144,
0.21825,
-0.00471,
-0.30056,
-0.00897,
0.3566,
0.0634,
-0.33622,
-0.13774,
0.23102,
0.04212,
-0.25214,
-0.051,
0.21612,
0.03201,
-0.15636,
0.10012,
0.18685,
-0.17658,
-0.31706,
0.08362,
0.32041,
-0.0377,
-0.283,
0.03467,
0.20228,
-0.09251,
-0.24682,
0.09267,
0.22357,
-0.11592,
-0.20904,
0.11927,
0.22995,
-0.09889,
-0.22554,
0.10331,
0.29806,
0.00753,
-0.19414,
0.04478,
0.11821,
-0.15051,
-0.19254,
0.13736,
0.19217,
-0.10687,
-0.08878,
0.19749,
0.12193,
-0.18935,
-0.13454,
0.1927,
0.09586,
-0.26119,
-0.07442,
0.33159,
0.18792,
-0.30216,
-0.27768,
0.15812,
0.17514,
-0.12337,
-0.0526,
0.14907,
-0.05473,
-0.24363,
0.04531,
0.30658,
0.02402,
-0.30588,
-0.06963,
0.26294,
0.06659,
-0.21915,
-0.07708,
0.16503,
0.0634,
-0.10102,
0.02669,
0.11874,
-0.167,
-0.25427,
0.10437,
0.2821,
-0.02812,
-0.22713,
0.08309,
0.27252,
-0.00311,
-0.23831,
-0.00684,
0.14694,
-0.06058,
-0.10847,
0.17568,
0.21771,
-0.11858,
-0.20585,
0.01338,
0.01817,
-0.20691,
-0.10847,
0.24592,
0.19803,
-0.17765,
-0.18563,
0.11342,
0.12459,
-0.07388,
-0.0542,
0.13204,
0.04797,
-0.15051,
-0.03238,
0.15492,
-0.02493,
-0.26651,
-0.0377,
0.26081,
0.0948,
-0.20319,
-0.10315,
0.1794,
0.11874,
-0.06324,
0.04957,
0.15918,
-0.02067,
-0.18403,
-0.01216,
0.12725,
-0.06271,
-0.10368,
0.1496,
0.24485,
-0.02174,
-0.23352,
-0.06643,
0.11714,
0.04903,
-0.05207,
-0.01322,
-0.01748,
-0.08932,
0.04318,
0.24964,
0.1081,
-0.24788,
-0.24469,
0.09267,
0.16025,
-0.11326,
-0.18722,
0.11608,
0.2076,
-0.0526,
-0.09996,
0.14109,
0.14854,
-0.08506,
-0.1255,
0.05382,
0.04478,
-0.12124,
-0.08612,
0.11981,
0.12672,
-0.01695,
-0.07122,
-0.06111,
-0.06909,
-0.05686,
0.01711,
0.05169,
-0.05686,
-0.04568,
0.16291,
0.18153,
-0.11379,
-0.24788,
-0.02333,
0.13204,
-0.00897,
-0.09304,
0.07564,
0.17568,
0.0799,
0.01338,
0.05702,
-0.08399,
-0.33568,
-0.28141,
0.05755,
0.24698,
0.09001,
-0.07708,
0.04318,
0.11927,
0.00327,
-0.00577,
0.06659,
-0.03557,
-0.17126,
-0.05632,
0.13524,
0.12247,
0.02349,
0.03786,
0.05914,
-0.0212,
-0.10528,
-0.05526,
0.02988,
0.01977,
-0.04196,
-0.00737,
0.05063,
-0.03398,
-0.10155,
-0.04462,
0.05861,
0.04957,
0.00327,
0.02988,
0.0219,
-0.06058,
-0.05047,
0.06127,
0.13364,
0.05808,
-0.09144,
-0.08027,
0.03892,
0.06606,
-0.0526,
-0.13029,
-0.0361,
0.06447,
0.07617,
0.02509,
-0.05526,
-0.05047,
0.00966,
0.01285,
-0.02706,
-0.01163,
0.03414,
0.07617,
0.05648,
-0.01748,
-0.04089,
-0.07229,
-0.11113,
-0.07016,
0.0352,
0.04478,
-0.06377,
-0.05047,
0.10278,
0.1661,
0.06393,
-0.01376,
-0.02387,
-0.04089,
-0.04994,
-0.03238,
-0.02493,
-0.01535,
-0.01588,
0.0336,
0.02881,
-0.03131,
-0.03238,
0.05489,
0.08628,
0.01924,
-0.03664,
0.05116,
0.1214,
0.01924,
-0.04994,
-0.00577,
0.01817,
]

#sf   = 1000; sf2 = sf/2;
#n    = 9;
#f    = 80;
#Rp   = 10;
#Rs   = 30;
#side = 40;

sf     = 1024; sf2 = sf/2;
nNotch = 3;
f      = 90;
Rp     = 1;
Rs     = 15;
side   = 10;
lowerBound = f - side;
upperBound = f + side;
Wn = [lowerBound, upperBound]/sf2;

f2      = 265;
Rp2     = 4;
Rs2     = 60;
side2   = 10;
lowerBound2 = f2 - side2;
upperBound2 = f2 + side2;
Wn2 = [lowerBound2, upperBound2]/sf2;

filterType = 'stop';

% Transfer function design

#[b,a] = ellip(nNotch, Rp, Rs, Wn, filterType);
[b,a] = ellip(4,1,20,90/sf2);

[b2,a2] = ellip(nNotch, Rp2, Rs2, Wn2, filterType);

output  = filter(b,a,d);
output2 = filter(b2,a2,output);
[h, w]   = freqz(b, a, length(d));
[h2, w2] = freqz(b2, a2, length(d));
impulseResponse=filter(b2,a2,filter(b,a,[1;zeros(sf-1,1)]))

disp(b)
disp(a)

disp(b2)
disp(a2)

#disp(output2)

 clf
 subplot ( 5, 1, 1 )
 plot(d, ";raw accel data;")
 ylim([-1 1])
 subplot ( 5, 1, 2 )
 plot(output,";low pass;")
 ylim([-1 1])
 subplot ( 5, 1, 3 ) 
 plot(output2, ";low pass and notch;")
 ylim([-1 1])
 subplot ( 5, 1, 4 )
 plot(w/pi,20*log10(abs(h)),";freq response notch;")
 subplot ( 5, 1, 5 )
 plot(impulseResponse,";impulse response;")
 ylim([-0.3 0.3])