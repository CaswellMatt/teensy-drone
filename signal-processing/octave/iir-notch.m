d = [    -3.09182,
    2.27887,
    -2.20999,
    0.48623,
    -0.22407,
    -2.04329,
    2.14358,
    -4.73468,
    3.74053,
    -5.49813,
    4.25514,
    -4.1621,
    2.97467,
    -1.75579,
    0.01753,
    0.8752,
    -2.92754,
    3.52793,
    -5.22754,
    5.72888,
    -6.7037,
    5.4607,
    -6.20117,
    3.90724,
    -4.82166,
    1.28591,
    -1.76787,
    -2.00947,
    2.79348,
    -4.36987,
    6.41743,
    -5.71315,
    6.29421,
    -6.28573,
    4.05461,
    -5.7808,
    2.76207,
    -3.76588,
    0.47656,
    -0.72901,
    -2.40569,
    2.80072,
    -4.02197,
    4.28896,
    -4.75884,
    3.82751,
    -4.65495,
    3.00366,
    -3.78762,
    2.16532,
    -2.22932,
    0.56837,
    -0.42943,
    -1.40789,
    1.24726,
    -3.09424,
    2.0711,
    -3.70789,
    2.44316,
    -3.2851,
    1.85125,
    -2.28489,
    0.84379,
    -1.01892,
    -0.20716,
    0.25671,
    -1.25327,
    1.28591,
    -2.60621,
    1.49852,
    -2.87197,
    1.17961,
    -2.56273,
    0.44757,
    -1.06966,
    -0.48016,
    0.43307,
    -1.64949,
    2.17499,
    -2.40327,
    2.53738,
    -3.09424,
    2.17016,
    -2.60621,
    0.99116,
    -1.77271,
    -0.8498,
    -0.04529,
    -2.67386,
    1.74253,
    -3.65716,
    3.21385,
    -3.75863,
    3.49652,
    -3.20537,
    2.83455,
    -2.11094,
    1.48402,
    -0.95852,
    -0.67344,
    0.5877,
    -2.7101,
    1.87541,
    -4.10895,
    2.77173,
    -4.36987,
    3.48203,
    -3.86976,
    3.09305,
    -2.82365,
    1.92131,
    -1.4852,
    0.25671,
    0.22289,
    -1.57943,
    1.62173,
    -3.34067,
    2.36343,
    -4.44235,
    2.63402,
    -4.27323,
    2.31995,
    -3.34308,
    1.40429,
    -1.83794,
    0.5587,
    -0.27239,
    -0.90054,
    0.83413,
    -1.86934,
    1.93822,
    -2.73909,
    2.02036,
    -3.11357,
    1.67005,
    -2.90821,
    0.7399,
    -1.92008,
    -0.07186,
    -0.38836,
    -1.44897,
    0.57078,
    -2.15201,
    1.43328,
    -2.46609,
    1.69663,
    -2.01672,
    1.30282,
    -1.66882,
    0.32436,
    -0.45117,
    -0.79665,
    0.70125,
    -2.49508,
    1.65314,
    -3.3455,
    2.23055,
    -3.78762,
    2.06868,
    -3.18605,
    1.39221,
    -2.01189,
    0.24704,
    -0.31829,
    -0.72176,
    1.06364,
    -2.67628,
    3.72121,
    -4.29256,
    6.03087,
    -5.39666,
    4.55713,
    -5.51021,
    1.63864,
    -4.21525,
    -0.55506,
    -1.06966,
    -1.20737,
    1.35114,
    -2.08678,
    2.64852,
    -4.17901,
    5.73612,
    -5.43048,
    7.12289,
    -5.38458,
    3.98696,
    -4.58972,
    0.31952,
    -2.91304,
    -1.53352,
    -0.02113,
    -1.42481,
    1.89232,
    -2.56756,
    2.94326,
    -4.43027,
    4.72867,
    -4.87722,
    4.4315,
    -4.02439,
    2.12908,
    -2.50474,
    -0.03562,
    -1.2122,
    -0.94161,
    0.05377,
    -1.58184,
    1.52268,
    -2.59655,
    2.24505,
    -3.11115,
    1.90681,
    -2.34529,
    1.39463,
    -1.52628,
    0.33885,
    -0.73384,
    -0.27239,
    -0.19266,
    -1.15422,
    0.12383,
    -1.15905,
    0.35335,
    -1.29193,
    -0.26756,
    -0.51157,
    -0.65411,
    0.20356,
    -1.67365,
    0.9815,
    -1.82344,
    1.49127,
    -1.94665,
    1.24484,
    -1.44172,
    0.50314,
    -0.53815,
    -0.93195,
    0.2253,
    -2.01672,
    2.24747,
    -3.57019,
    4.29138,
    -4.93279,
    4.54747,
    -5.48846,
    3.03266,
    -5.18164,
    1.74736,
    -3.56777,
    -0.07186,
    -1.52869,
    -1.77754,
    1.23276,
    -3.35033,
    4.95093,
    -4.64287,
    10.09695,
    -5.94025,
    9.07982,
    -7.10475,
    4.18266,
    -6.64813,
    0.99358,
    -4.50516,
    -1.33058,
    -1.41997,
    -2.42502,
    1.60723,
    -3.63542,
    4.62236,
    -4.98594,
    8.88655,
    -5.79288,
    9.13539,
    -6.3558,
    5.0065,
    -5.93783,
    1.10471,
    -4.27806,
    -1.32817,
    -0.98027,
    -1.66399,
    1.6773,
    -2.79466,
    2.88045,
    -4.60422,
    5.60324,
    -5.58752,
    6.48507,
    -4.84098,
    3.64631,
    -3.8746,
    0.66259,
    -2.20275,
    -0.2748,
    0.02478,
    -0.58646,
    1.03465,
    -1.46105,
    1.3149,
    -2.80674,
    1.39463,
    -2.62313,
    1.52509,
    -1.95149,
    0.9066,
    -1.7268,
    0.29295,
    -1.3934,
    -0.183,
    -1.04791,
    -0.11294,
    -0.84014,
    0.07793,
    -1.15905,
    0.6795,
    -1.70747,
    1.25209,
    -2.0143,
    1.49127,
    -1.83794,
    0.87278,
    -1.61808,
    -0.15159,
    -1.24602,
    -1.11315,
    0.01028,
    -2.42743,
    3.0399,
    -3.62092,
    5.26259,
    -4.89172,
    4.77215,
    -5.81462,
    3.59316,
    -5.82187,
    2.67268,
    -5.1913,
    0.74232,
    -3.6934,
    -1.73405,
    -0.39319,
    -3.51462,
    4.78906,
    -4.47376,
    9.86743,
    -5.18405,
    10.17667,
    -6.36546,
    5.49453,
    -7.16031,
    2.40209,
    -6.38962,
    1.28349,
    -3.96882,
    -1.47796,
    -1.04791,
    -4.07754,
    2.96501,
    -4.71052,
    8.40094,
    -4.76126,
    10.41344,
    -6.02481,
    6.23381,
    -6.93804,
    2.65335,
    -5.66966,
    0.89936,
    -3.40348,
    -0.91262,
    -0.38836,
    -2.66903,
    1.92131,
    -3.66199,
    5.21186,
    -4.56798,
    6.84747,
    -5.06809,
    4.53539,
    -4.5704,
    1.62415,
    -3.06766,
    0.54421,
    -0.9392,
    -0.13951,
    -0.02113,
    -0.85705,
    0.67225,
    -2.32113,
    0.98391,
    -2.59655,
    1.32698,
    -2.29455,
    0.59011,
    -1.76062,
    0.2253,
    -1.14455,
    -0.11052,
    -0.64203,
    0.03685,
    -0.48016,
    0.3316,
    -1.01892,
    0.79547,
    -1.66399,
    1.11679,
    -2.44193,
    1.57583,
    -2.4371,
    1.37047,
    -2.22449,
    0.3316,
    -1.11798,
    -0.65653,
    0.38959,
    -1.97323,
    1.52751,
    -2.94687,
    3.30083,
    -3.94949,
    4.61995,
    -5.12124,
    4.40251,
    -5.20821,
    3.54001,
    -5.13332,
    1.96238,
    -3.80212,
    -0.66861,
    -0.87638,
    -3.058,
    3.2815,
    -3.72964,
    7.03591,
    -4.32155,
    8.02163,
    -5.61168,
    5.51385,
    -6.37996,
    3.57866,
    -6.04655,
    2.6002,
    -4.63321,
    -0.23856,
    -2.22932,
    -3.08699,
    1.93822,
    -4.43752,
    6.46816,
    -4.60422,
    8.38161,
    -5.63825,
    5.01858,
    -6.21084,
    3.06648,
    -4.83132,
    1.97929,
    -2.86472,
    0.02478,
    -0.58888,
    -2.53373,
    1.81742,
    -3.69582,
    4.19474,
    -4.13552,
    3.68738,
    -4.28531,
    2.48181,
    -3.50737,
    1.67005,
    -2.1351,
    1.31249,
    -0.92228,
    -0.0622,
    0.05618,
    -1.34025,
    0.87761,
    -2.36945,
    1.06364,
    -2.483,
    0.88003,
    -2.0288,
    0.119,
    -1.09382,
    -0.27964,
    -0.09119,
    -0.86672,
    0.54904,
    -1.07207,
    0.72057,
    -1.031,
    0.25671,
    -0.52848,
    -0.76766,
    -0.14676,
    -2.02638,
    0.59978,
    -2.78983,
    1.42845,
    -3.16672,
    1.87299,
    -2.67628,
    1.58791,
    -1.48037,
    0.5587,
    -0.17817,
    -0.92953,
    1.31249,
    -2.59413]

#sf   = 1000; sf2 = sf/2;
#n    = 9;
#f    = 80;
#Rp   = 10;
#Rs   = 30;
#side = 40;

sf     = 1000; sf2 = sf/2;
nNotch = 4;
f      = 90;
Rp     = 4;
Rs     = 60;
side   = 70;
lowerBound = f - side;
upperBound = f + side;
Wn = [lowerBound, upperBound]/sf2;
filterType = 'stop';

% Transfer function design
#[b, a]=butter(7, 220/sf2);
nLowPass      = 6;
[b, a]=ellip(nLowPass, Rp, Rs, 30/sf2);
#
#[b2,a2] = cheby1(n, Rp, Wn, filterType);
[b2,a2] = ellip(nNotch, Rp, Rs, Wn, filterType);

output  = filter(b,a,d);
output2 = filter(b2,a2,output);
[h, w]   = freqz(b, a, length(d));
[h2, w2] = freqz(b2, a2, length(d));
impulseResponse=filter(b2,a2,filter(b,a,[1;zeros(sf-1,1)]))

disp(b)
disp(a)

disp(b2)
disp(a2)

#disp(output2)

 clf
 subplot ( 5, 1, 1 )
 plot(d, ";raw accel data;")
 ylim([-1 1])
 subplot ( 5, 1, 2 )
 plot(output,";low pass;")
 ylim([-1 1])
 subplot ( 5, 1, 3 ) 
 plot(output2, ";low pass and notch;")
 ylim([-1 1])
 subplot ( 5, 1, 4 )
 plot(w/pi,20*log10(abs(h)),";freq response notch;")
 subplot ( 5, 1, 5 )
 plot(impulseResponse,";impulse response;")
 ylim([-0.3 0.3])